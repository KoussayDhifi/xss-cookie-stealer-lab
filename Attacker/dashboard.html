<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>üç™ Stolen Cookies Control Panel</title>

<style>
    /* TERMINAL THEME */
    body {
        background: #000;
        color: #00ff55;
        font-family: "Courier New", monospace;
        padding: 30px;
        overflow-x: hidden;
    }

    /* Scanlines effect */
    body::after {
        content: "";
        pointer-events: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: repeating-linear-gradient(
            rgba(0,255,0,0.05) 0px,
            rgba(0,255,0,0.05) 1px,
            transparent 1px,
            transparent 3px
        );
        z-index: 99999;
    }

    h1 {
        text-align: center;
        font-size: 36px;
        text-shadow: 0 0 15px #00ff55;
        margin-bottom: 20px;
    }

    .controls {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 15px;
    }

    .btn {
        padding: 10px 16px;
        border: 1px solid #00ff55;
        background: transparent;
        color: #00ff55;
        font-size: 16px;
        border-radius: 6px;
        cursor: pointer;
        transition: 0.2s;
    }

    .btn:hover {
        background: #00ff5522;
        box-shadow: 0 0 10px #00ff55;
    }

    .search-box {
        width: 300px;
        padding: 10px;
        border: 1px solid #00ff55;
        background: #000;
        color: #00ff55;
        border-radius: 6px;
        font-size: 16px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        background: #001900;
        border: 1px solid #00ff55;
        box-shadow: 0 0 20px #00ff5522;
    }

    th, td {
        padding: 12px;
        border-bottom: 1px solid #004400;
    }

    th {
        background: #003300;
        text-align: left;
    }

    tr:hover {
        background: #002200;
    }

    .copy-btn {
        cursor: pointer;
        padding: 5px 10px;
        border: 1px solid #00ff55;
        background: #000;
        color: #00ff55;
        border-radius: 4px;
    }

    .pagination {
        margin-top: 20px;
        display: flex;
        justify-content: center;
        gap: 15px;
    }
</style>
</head>

<body>
<h1>üç™ Stolen Cookies Panel</h1>

<div class="controls">
    <input type="text" id="search" class="search-box" placeholder="Search‚Ä¶">
    <button class="btn" onclick="exportCSV()">Export CSV</button>
</div>

<table>
    <thead>
        <tr>
            <th>PHPSESSID</th>
            <th>session_user</th>
            <th>Copy</th>
        </tr>
    </thead>
    <tbody id="cookie-table"></tbody>
</table>

<div class="pagination">
    <button class="btn" onclick="prevPage()">Prev</button>
    <span id="page-info"></span>
    <button class="btn" onclick="nextPage()">Next</button>
</div>

<script>
let allCookies = [];
let filteredCookies = [];
let currentPage = 1;
const perPage = 10;

async function loadCookies() {
    const res = await fetch("http://127.0.0.1:8000/cookies", { cache: "no-store" });
    const data = await res.json();
    allCookies = data.stolen_cookies;
    applySearch();
}

function parseCookies() {
    return filteredCookies.map(line => {
        let parts = line.split(";");

        let sess = "";
        let user = "";

        parts.forEach(p => {
            const [key, value] = p.split("=");
            if (!value) return;

            if (key.trim() === "PHPSESSID") sess = value.trim();
            if (key.trim() === "session_user") user = value.trim();
        });

        return { sess, user };
    });
}

function render() {
    const table = document.getElementById("cookie-table");
    table.innerHTML = "";

    const parsed = parseCookies();

    const start = (currentPage - 1) * perPage;
    const end = start + perPage;
    const pageItems = parsed.slice(start, end);

    pageItems.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${row.sess}</td>
            <td>${row.user}</td>
            <td><button class="copy-btn" onclick="copyText('PHPSESSID=${row.sess}; session_user=${row.user}')">Copy</button></td>
        `;
        table.appendChild(tr);
    });

    document.getElementById("page-info").innerText =
        `Page ${currentPage} / ${Math.ceil(parsed.length / perPage)}`;
}

function copyText(text) {
    navigator.clipboard.writeText(text);
    alert("Copied: " + text);
}

function prevPage() {
    if (currentPage > 1) {
        currentPage--;
        render();
    }
}

function nextPage() {
    const total = Math.ceil(filteredCookies.length / perPage);
    if (currentPage < total) {
        currentPage++;
        render();
    }
}

document.getElementById("search").addEventListener("input", applySearch);

function applySearch() {
    const q = document.getElementById("search").value.toLowerCase();
    filteredCookies = allCookies.filter(c => c.toLowerCase().includes(q));
    currentPage = 1;
    render();
}

function exportCSV() {
    const parsed = parseCookies();
    let csv = "PHPSESSID,session_user\n";

    parsed.forEach(row => {
        csv += `${row.sess},${row.user}\n`;
    });

    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "stolen_cookies.csv";
    a.click();
}

setInterval(loadCookies, 2000);
loadCookies();
</script>

</body>
</html>
